<!DOCTYPE html>
<html lang="en">
	
	<head>
		<title>Job Results</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="shortcut icon" href="https://static.wixstatic.com/media/9815c9_642c9beb50dd45339ddfa02bba2a1182%7Emv2.png/v1/fill/w_32%2Ch_32%2Clg_1%2Cusm_0.66_1.00_0.01/9815c9_642c9beb50dd45339ddfa02bba2a1182%7Emv2.png" type="image/png">
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
		<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">

		<link rel="stylesheet" href="../dest/css/sb-admin-2.css">
		<link rel="stylesheet" href="../dest/css/bootstrap-tagsinput.css">
		<link rel="stylesheet" href="../dest/css/custom.css">
		<link rel="stylesheet" href="../dest/css/sweetalert.css">
		<link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular.min.js"></script>
		<script src="../dest/js/bootstrap-tagsinput.min.js"></script>
		<script src="../dest/js/bootstrap-tagsinput-angular.min.js"></script>
		
		<!-- Select JavaScript -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
		
		<script src="../dest/js/bootstrap-table-export.js"></script>
		<script src="https://rawgit.com/hhurz/tableExport.jquery.plugin/master/tableExport.js"></script>

		<script src="https://code.highcharts.com/highcharts.js"></script>
		<script src="../dest/js/sweetalert-dev.js"></script>
		<script src="../dest/js/app.js"></script>

		<script src="../dest/js/selectize.js"></script>
		<script src="../dest/js/index.js"></script>
		
		<style>
			.clickable{
            cursor: pointer;
			}
			.panel-heading span {
            margin-top: -20px;
            font-size: 15px;
			}
			
			#stats th, #stats td {
            border: 1px !important;
			}
			
			.data-filter-header{
            border-bottom: 1px solid #f7f7f7;
            margin-left: 15px;
            padding-bottom: 15px;
            margin-bottom: 30px;
            margin-top: 15px;
			}
			
			#src_column .glyphicon{
            //top: -15px;
			}
			
			.badge{
            margin-right: 4px;
			}
			
			#mapper div img{
            cursor: pointer;
			}
			
			.list-group-item {
            position: relative;
            display: block;
            padding: 10px 15px;
            margin-bottom: 0px;
            background-color: #fff;
            border: 1px solid #ddd;
			}
			
			#loadingDiv{
			position: absolute;
			z-index: 1;
			height: 100px;
			width: 100px;
			top: 50%;
			left: 50%;
			margin-left: -50px;
			margin-top: -50px;
			background: url('../dest/img/loading.gif');
			background-size: 100%;
			}
			
			.a{
			display:none;
			}
			.job{
			display:none;
			}
			
		</style>
	</head>
	
	<body>
		<script>
			var tblData = [];

			var condition_sql = Array();
			var condition_sql_current = -1;
			var condition_column = Array();
			var condition_column_current = -1;
			var condition_notempty = Array();
			var condition_notempty_current = -1;
			var condition_notnull = Array();
			var condition_notnull_current = -1;

			var sample_data_column = Array();
			var sample_data_notnull = Array();
			var sample_data_notempty = Array();

			var inputData = Array();
			var srcColumns = Array();
			var srcRecordCnt = 0, destRecordCnt = 0;
			var default_job_name = "";

			$(document).ready(function(){
				
				$('#logout').on('click', function(e){
					setCookie("email", "");
					setCookie("password", "");
				});
			});

			$('#src_table_panel').hide();

			var QueryString = function () {
				// This function is anonymous, is executed immediately and
				// the return value is assigned to QueryString!
				var query_string = {};
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i=0;i<vars.length;i++) {
					var pair = vars[i].split("=");
					// If first entry with this name
					if (typeof query_string[pair[0]] === "undefined") {
						query_string[pair[0]] = decodeURIComponent(pair[1]);
						// If second entry with this name
						} else if (typeof query_string[pair[0]] === "string") {
						var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
						query_string[pair[0]] = arr;
						// If third or later entry with this name
						} else {
						query_string[pair[0]].push(decodeURIComponent(pair[1]));
					}
				}
				return query_string;
			}();
			
			//Get Job Result from server with job id
			function getJobResult(jobId) {

				//jobId = "69893692875460-SAMPLE";

				$.ajax({
					type: "GET",
					url: "/job/" + jobId,
					dataType: "json",
					data: {},
					success: function (response) {

						//createAdvancedRulePage(response);

						setValidation(response);
					},
					// xhr: function() {
					// 	var xhr = new window.XMLHttpRequest();
					// 	xhr.addEventListener("progress", function(evt) {
					// 		var percentComplete = evt.loaded / evt.total * 80;
					// 		console.log(percentComplete);
					// 	}, false);

					// 	return xhr;
					// },
					error: function(response) {
						//alert(response);
					}
				});
			}

			function createAdvancedRulePage(response) {
				//make src and dest transformation column inputs to typeahead
				if (response.exception != null)
				return;
				createTypeahead($('.src_trans_column'), makeSrcColumn(response.srcSchema), 'name');
				createTypeahead($('.dest_trans_column'), makedestColumn(response.destSchema), 'name');
				
				srcRecordCnt = response.srcRowCount;
				destRecordCnt = response.destRowCount;
				
				prepareAdvancedRule(true, response.inputData.name, response.srcSchema, response.inputData.srcFile.excludeColmns,
                response.destSchema, response.inputData.destFile.excludeColmns,
                response.inputData.compareKey,
                response.inputData.srcFile.transformations, response.inputData.destFile.transformations,
                response.inputData.srcFile.filterSql, response.inputData.destFile.filterSql,
                response.inputData.matchBoth, response.srcRowCount != response.destRowCount, response.inputData.randomSample, response.inputData.columnMapping
				);
				//$('#advancedRulesmodal').show();
				$('#advancedRulesModal').show();
				$('#loadingDiv').hide();
			}
			
			function setValidation(response){

				inputData = response.inputData;
				$('#job_name').val(inputData.name);
				default_job_name = inputData.name;
				srcColumns = response.srcSchema;

				if (response.srcValidationStmt)
					setcondition(response.srcValidationStmt);
				else{
					setcondition(response.inputData.srcvalidationSQL);
				}

				if (response.exception){
					$('.alert-danger').show();
					$('#danger-msg').html(response.exception);
				}

				if (response.sampleData){
					var table = document.getElementById("src_table");
					var columns = Array();
					var tabledata = Array();

					/*data set*/
					for (var i = 0; i < response.sampleData.length; i++) {
						var row = response.sampleData[i];
						var rowdata = {};
						for (var j = 0; j < row.length; j++) {
							var cell = row[j];
							var col = cell.col;
							var colType = cell.colType;
							var value = cell.value;
							rowdata[col] = value;
							/*header*/
							if (i == 0) columns.push(cell.col);
						}
						/*data*/
						tabledata.push(rowdata);
					}
					/*header*/
					table.innerHTML = "";
					var thead = document.createElement("thead");
					var tr = document.createElement("tr");
					for (var i = 0; i < columns.length; i++) {
						var colname = columns[i];
						var th = document.createElement("th");
						th.setAttribute("data-field", colname);
						th.setAttribute("data-sortable", "true");
						th.innerHTML = colname;
						tr.appendChild(th);
					}
					thead.appendChild(tr);
					table.appendChild(thead);		
					/*datalist*/
					$('#src_table').bootstrapTable("destroy");
					$('#src_table').bootstrapTable({
						data: tabledata
					});
					$('#src_table').bootstrapTable('refresh');

					$('#src_table_panel').show();

				}
			}

			function setcondition(srcvalidationStmt){
				condition_sql = Array();
				condition_column = Array();
				condition_notnull = Array();
				condition_notempty = Array();
				
				var default_unique_fields = Array();
				var default_column_fields = Array();
				var default_notnull_fields = Array();
				var default_notempty_fields = Array();

				if (srcvalidationStmt){
					for(i = 0 ; i < srcvalidationStmt.length ; i++){
						var srcValidationStmt = srcvalidationStmt[i];
						var validationPass = srcValidationStmt.validationPass;
						var validationStatement = srcValidationStmt.validationStatement;
						if (validationStatement.sql){
							//$('#validation_src_sql').val(validationStatement.sql);
							//$('#validation_src_sql_value_min').val(validationStatement.sqlValidRangeMin);
							//$('#validation_src_sql_value_max').val(validationStatement.sqlValidRangeMax);

							var condition = create_new_item(true, 'sql', validationStatement.sql, validationStatement.sqlValidRangeMin, validationStatement.sqlValidRangeMax, srcValidationStmt.validActual, srcValidationStmt.validationPass);

							/*
							if (validationPass == false)
							{
								//$('#validation_src_sql').css('color', 'red');
								//$('#validation_src_sql_value_min').css('color', 'red');
								//$('#validation_src_sql_value_max').css('color', 'red');

								$('#failed_messge_sql').show();
							}*/
							condition_sql.push(condition);

						}
						if (validationStatement.uniqueColumns){
							$('#validation_src_unique_cols').val(validationStatement.uniqueColumns.join(", "));
							if (validationPass == false)
							{
								//$('#validation_src_unique_cols').css('color', 'red');
								$('#failed_messge_unique').show();
								if (srcValidationStmt.sampleData){
									$('#sample_data_unique').removeClass('hidden');
									setSampleDataTable(srcValidationStmt.sampleData, 'unique');
								}
							}

							/*default value on autocomplete*/
							for(j = 0 ; j < validationStatement.uniqueColumns.length ; j++)
							{
								default_unique_fields.push(validationStatement.uniqueColumns[j]);
							}

						}
						if (validationStatement.columnName && (validationStatement.columnRangeMin || validationStatement.columnRangeMax))
						{
							//$('#validation_src_column_name').val(validationStatement.columnName);
							//$('#validation_src_column_min').val(validationStatement.columnRangeMin);
							//$('#validation_src_column_max').val(validationStatement.columnRangeMax);

							/*
							if (validationPass == false)
							{
								var condition = {};
								condition['column'] = validationStatement.columnName;
								condition['min'] = validationStatement.columnRangeMin;
								condition['max'] = validationStatement.columnRangeMax;

								condition_column.push(condition);

								if (srcValidationStmt.sampleData)
								{
									$('#sample_data_column').removeClass('hidden');
									setSampleDataTable(srcValidationStmt.sampleData, 'column');
								}
							}
							*/

							sample_data_column.push(srcValidationStmt.sampleData);

							var condition = create_new_item(true, 'column', validationStatement.columnName, validationStatement.columnRangeMin, validationStatement.columnRangeMax, srcValidationStmt.validActual, srcValidationStmt.validationPass);

							condition_column.push(condition);

							/*default value on autocomplete*/
							default_column_fields.push(validationStatement.columnName);

						}
						if (validationStatement.columnName && validationStatement.notNull){

							sample_data_notnull.push(srcValidationStmt.sampleData);

							var condition = create_new_item(true, 'notnull', validationStatement.columnName, null, null, null, srcValidationStmt.validationPass);

							condition_notnull.push(condition);

							/*default value on autocomplete*/
							default_notnull_fields.push(validationStatement.columnName);
						}

						if (validationStatement.columnName && validationStatement.notEmpty){

							sample_data_notempty.push(srcValidationStmt.sampleData);

							var condition = create_new_item(true, 'notempty', validationStatement.columnName, null, null, null, srcValidationStmt.validationPass);

							condition_notempty.push(condition);

							/*default value on autocomplete*/
							default_notempty_fields.push(validationStatement.columnName);
						}
					}

					show_data_table(condition_sql, 'table_condition_sql');
					show_data_table(condition_column, 'table_condition_column');
					show_data_table(condition_notnull, 'table_condition_notnull');
					show_data_table(condition_notempty, 'table_condition_notempty');

					$('table tr').click(function(){
						edit_function(this);
					});

					/*srcColumns default*/
					/*var srcColumns = [{"name" : "name"}, {"name" : "company"}, {"name" : "phone"}, {"name" : "email"}, {"name" : "date"}, {"name" : "street"}];*/

					setSelect(srcColumns, 'validation_src_unique_cols', null, default_unique_fields);
					setSelect(srcColumns, 'validation_src_column_name', 1);
					setSelect(srcColumns, 'validation_src_notnull_cols', null, default_notnull_fields);
					setSelect(srcColumns, 'validation_src_notempty_cols', null, default_notempty_fields);

				}

			}

			//To Fetch URL parameters.
			function param(name) {
				return (location.search.split(name + '=')[1] || '').split('&')[0];
			}

			//To Set the Cookie.
			$(document).ready(function(){
				var currentpara= param('jobId');
				
			});

			$(document).ready(function () {
				$.ajax({
					type: "GET",
					url: "/startUp",
					crossDomain: true,
					dataType: 'json',
					data: {},
					beforeSend: function() {
						//$("#loadingDiv").show();
					},
					success: function (response) {
						if (response.localMode == true) {
							$('#nav_logout').hide();
							$('#cluster_resources').hide();
						}
						setCookie("version", response.displayVersion);
						setCookie("localMode", response.localMode);
						setToolDetail();
					},
					error: function (response) {

					},
					complete: function() {
						//$("#loadingDiv").hide();
					}
				});

				jobId =  QueryString.jobId;
				edit = QueryString.edit;
				if (jobId != null) {
					getJobResult(jobId);
					} /* else {
					getDataFromJsonFile("../json/diff_result.json");
				}*/
			});

			function sample_data_show(type){

				if (type == 'column')
					setSampleDataTable(sample_data_column[condition_column_current], 'column');
				if (type == 'notnull')
					setSampleDataTable(sample_data_notnull[condition_notnull_current], 'notnull');
				if (type == 'notempty')
					setSampleDataTable(sample_data_notempty[condition_notempty_current], 'notempty');

				$('.sample_data_div').hide();
				$('.sample_data_table_' + type).show();
				$('#advancedRulesModal').show();
			}

			function setSampleDataTable(data, type){

				if (!data || data.legnth == 0) return;
				var id = "sample_data_table_" + type;
				var table = document.getElementById(id);
				var columns = Array();

				/*setting data*/
				var tabledata = Array();
				for (var i = 0; i < data.length; i++) {
					var row = data[i];
					var rowdata = {};
					for (var j = 0; j < row.length; j++) {
						var cell = row[j];
						var col = cell.col;
						var value = cell.value;
						rowdata[col] = value;

						/*set header*/
						if (i == 0){
							columns.push(cell.col);
						}
					}
					tabledata.push(rowdata);
				}

				/**/
				table.innerHTML = "";
				var thead = document.createElement("thead");
				var tr = document.createElement("tr");
				/*header*/
				for (var i = 0; i < columns.length; i++) {
					var col = columns[i];
					var th = document.createElement("th");
					th.setAttribute("data-field", col);
					th.setAttribute("data-sortable", "true");
					th.innerHTML = col;
					tr.appendChild(th);
				}
				thead.appendChild(tr);
				table.appendChild(thead);

				$('#' + id).bootstrapTable("destroy");
				$('#' + id).bootstrapTable({
					data: tabledata
				});
				//$('#' + id).bootstrapTable('refresh');
			}

			$(function(){
				$('#btn_close').click(function(){
					$('#advancedRulesModal').hide();
				});
				$('#advanced').click(function(){
					$('#advancedRulesModal').hide();
				});
			});
			

		</script>

		<div id="wrapper">

			<!-- Navigation -->
			<nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<!--
							<span class="icon-bar"></span>
						-->
					</button>
					<a class="navbar-brand" href="home.html" style="font-size: 21px;" id="tool-name"></a>
					<span class="navbar-brand" style="font-size: 18px;" id="tool-version"></span>
				</div>
				<!-- /.navbar-header -->

				<ul class="nav navbar-top-links navbar-right">
					<li>
						<a href="home.html">Home</a>
					</li>
					<!--
					<li>
						<a href="addjob.html">Add Job</a>
					</li>
					-->
					<!--
						<li>
						<a href="jobresults.html">Job Results</a>
						</li>
					-->
					<li class="dropdown" id="nav_logout">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">
							<i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
						</a>
						<ul class="dropdown-menu dropdown-user">
							<!--<li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>-->
							<!--</li>-->
							<!--<li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>-->
							<!--</li>-->
							<!--<li class="divider"></li>-->
							<li><a href="login.html" id="logout"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
							</li>
						</ul>
						<!-- /.dropdown-user -->
					</li>
					<!-- /.dropdown -->
				</ul>
				<!-- /.navbar-top-links -->
			</nav>

			<div id="page-wrapper" style="margin: 0 0 0 0;">
				<div class="row">
					<div class="col-lg-12">
						<h3 class="page-header">Validation Check Result</h3>
					</div>
					<!-- /.col-lg-12 -->
				</div>

				<div class="alert alert-success alert-dismissible" role="alert" style="display:none;">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<strong>SUCCESS!</strong> <span id="success-msg">Check Validation has passed successfully.</span>
				</div>

				<div class="alert alert-info alert-dismissible" role="alert" style="display:none;">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<strong>RUNNING!</strong> Job is running now.
				</div>

				<div class="alert alert-danger alert-dismissible" role="alert" style="display:none;">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<strong>ERROR!</strong> <span id="danger-msg">Check Validation has failed.</span>
				</div>

				<div class="row">
					<div class="col-lg-12">
						<div class="panel panel-default">
							<div class="panel-heading summary" data-toggle="collapse" data-parent="#accordion"data-target="#specialCollapse">
								<h3 class="panel-title accordion-toggle summary">Summary</h3>
							</div>
							<div id="specialCollapse" class="panel-collapse collapse in">
								<div class="panel-body">
											<div class="col-md-offset-2 col-md-8">
												<div class="col-md-12">
													<!-- <label>Source Dataset</label> -->
													<div class="form-group row" style="margin-top: 15px;">

														<div class="col-sm-12">
															<label class="col-sm-offset-2 col-sm-2" style="margin-top:13px;">Job Name <span style="color: red;">*</span></label>
															<div class="col-sm-6">
																<input type="text" id="job_name" placeholder="Name" class="form-control" style="margin-top:9px;">
															</div>
														</div>

														<!--<label class="col-sm-3">Column</label>--> 
														<div class="col-md-12">
															<label class="col-sm-12 data-filter-header font-weight-bold text-center">SQL Condition</label>
														</div>

														<div class="col-sm-12" style="margin-bottom:15px;">
															<label class="col-sm-2">SQL</label>
															<div class="col-sm-8">
																<input type="text" class="form-control" id="validation_src_sql" placeholder="Enter Validation SQL">
															</div>
															<div class="col-sm-2">
																<a class="btn btn-primary col-sm-12" href="javascript:save_sql('add')" id="add_btn_sql">ADD</a>
															</div>
														</div>
														<div class="col-sm-12">
															<label class="col-sm-2">Excepted Min</label>
															<div class="col-sm-3">
																<input type="number" class="form-control" id="validation_src_sql_value_min" placeholder="Enter expected min value">
															</div>
															<label class="col-sm-2">Excepted Max</label>
															<div class="col-sm-3">
																<input type="number" class="form-control" id="validation_src_sql_value_max" placeholder="Enter expected max value">
															</div>
															<div class="col-sm-2">
																<a class="btn btn-primary col-sm-12 disabled" href="javascript:save_sql('save')" id="save_btn_sql">SAVE</a>
															</div>
														</div>

														<div class="col-sm-12" style="margin-top:20px;">
															<div class="col-sm-12">
																<table id="table_condition_sql" class="table table-hover"
																	data-height="100%"
																	data-search="true"
																	data-show-export="true"
																	data-show-columns="true"
																	data-pagination="true" >
																</table>
															</div>
														</div>

														<!-- 
														<div class="col-sm-12" style="margin-top:10px; color:red; display:none;" id="failed_messge_sql">
															<label class="col-sm-offset-2 col-sm-3">Validation Failed</label>
														</div> -->

														<div class="col-md-12">
															<label class="col-sm-12 data-filter-header font-weight-bold text-center">Unique Condition</label>
														</div>

														<div class="col-sm-12">
															<label class="col-sm-2">Unique Cols</label>
															<div class="col-sm-10">
																<!-- <input type="text" class="form-control" id="validation_src_unique_cols" placeholder="Enter Unique Columns"> -->

																<select id="validation_src_unique_cols" multiple placeholder="Select fields..."></select>
															</div>
														</div>	

														<div class="col-sm-12" style="margin-top:10px; color:red; display:none;" id="failed_messge_unique">
															<label class="col-sm-offset-2 col-sm-3">Validation Failed</label>

															<div class="col-sm-7 text-right sample_data_sec" id="sample_data_unique">
																<a href="javascript:sample_data_show('unique')">sample data</a>
															</div>
														</div>

														

														<div class="col-md-12">
															<label class="col-sm-12 data-filter-header font-weight-bold text-center">Column Range Condition</label>
														</div>

														<div class="col-sm-12" style="margin-bottom:15px;">
															<label class="col-sm-2">Column</label>
															<div class="col-sm-8">
																<!-- <input type="text" class="form-control" id="validation_src_column_name" placeholder="Enter Column Name"> -->

																<select id="validation_src_column_name" placeholder="Select fields..." class="form-control"></select>

																<span style="margin-top:10px">(Only Numeric Columns)</span>
															</div>

															<div class="col-sm-2">
																<a class="btn btn-primary col-sm-12" href="javascript:save_column('add')" id="add_btn_column">ADD</a>
															</div>
														</div>


														<div class="col-sm-12">
															<label class="col-sm-2">Column Min</label>
															<div class="col-sm-3">
																<input type="number" class="form-control" id="validation_src_column_min" placeholder="Enter expected min value">
															</div>	
															<label class="col-sm-2">Column Max</label>
															<div class="col-sm-3">
																<input type="number" class="form-control" id="validation_src_column_max" placeholder="Enter expected max value">
															</div>
															<div class="col-sm-2">
																<a class="btn btn-primary col-sm-12 disabled" href="javascript:save_column('save')" id="save_btn_column">SAVE</a>
															</div>
														</div>

														<div class="col-sm-12" style="margin-top:15px;">
															<div class="col-sm-12">
																<table id="table_condition_column" class="table table-hover"
																	data-height="100%"
																	data-search="true"
																	data-show-export="true"
																	data-show-columns="true"
																	data-pagination="true" >
																</table>
															</div>
														</div>

														<div class="col-md-12">
															<label class="col-sm-12 data-filter-header font-weight-bold text-center">Not Null Condition</label>
														</div>

														<div class="col-sm-12" style="margin-bottom:25px;">
															<label class="col-sm-2">Not Null</label>
															<div class="col-sm-10">
																<select id="validation_src_notnull_cols" multiple placeholder="Select fields..."></select>

															</div>
														</div>

														<div class="col-sm-12" style="margin-top:15px;">
															<div class="col-sm-12">
																<table id="table_condition_notnull" class="table table-hover"
																	data-height="100%"
																	data-search="true"
																	data-show-export="true"
																	data-show-columns="true"
																	data-pagination="true" >
																</table>
															</div>
														</div>

														<div class="col-md-12">
															<label class="col-sm-12 data-filter-header font-weight-bold text-center">Not Empty Condition</label>
														</div>

														<div class="col-sm-12" style="margin-bottom:25px;">
															<label class="col-sm-2">Not Empty</label>
															<div class="col-sm-10">
																<select id="validation_src_notempty_cols" multiple placeholder="Select fields..."></select>

															</div>
														</div>

														<div class="col-sm-12" style="margin-top:15px;">
															<div class="col-sm-12">
																<table id="table_condition_notempty" class="table table-hover"
																	data-height="100%"
																	data-search="true"
																	data-show-export="true"
																	data-show-columns="true"
																	data-pagination="true" >
																</table>
															</div>
														</div>

													</div>
												</div>
												<div class="col-md-6 hidden">
													<label>Destination Dataset</label>
													<div class="form-group row" style="margin-top: 15px;">

														<div class="col-sm-12" style="margin-bottom:15px;">
															<label class="col-sm-2">SQL</label>
															<div class="col-sm-10">
																<input type="text" class="form-control" id="validation_dest_sql" placeholder="Enter Validation SQL">
															</div>
														</div>
														<div class="col-sm-12">
															<label class="col-sm-2">Min</label>
															<div class="col-sm-4">
																<input type="text" class="form-control" id="validation_dest_sql_value_min" placeholder="Enter expected min value">
															</div>
															<label class="col-sm-2">Max</label>
															<div class="col-sm-4">
																<input type="text" class="form-control" id="validation_dest_sql_value_max" placeholder="Enter expected max value">
															</div>
														</div>

														<div class="col-sm-12">
															<hr width="100%" size="8">
														</div>

														<div class="col-sm-12">
															<label class="col-sm-3">Unique Cols</label>
															<div class="col-sm-9">
																<input type="text" class="form-control" id="validation_dest_unique_cols" placeholder="Enter Unique Columns">
															</div>
														</div>

														<div class="col-sm-12">
															<hr width="100%" size="8">
														</div>

														<div class="col-sm-12" style="margin-bottom:15px;">
															<label class="col-sm-3">Column</label>
															<div class="col-sm-9">
																<input type="text" class="form-control" id="validation_dest_column_name" placeholder="Enter Column Name">
															</div>
														</div>

														<div class="col-sm-12">
															<label class="col-sm-2">Min</label>
															<div class="col-sm-4">
																<input type="text" class="form-control" id="validation_dest_column_min" placeholder="Enter expected min value">
															</div>	
															<label class="col-sm-2">Max</label>
															<div class="col-sm-4">
																<input type="text" class="form-control" id="validation_dest_column_max" placeholder="Enter expected max value">
															</div>
														</div>

														<div class="col-sm-12">
															<hr width="100%" size="8">
														</div>

														<div class="col-sm-12" style="margin-bottom:25px;">
															<label class="col-sm-2">Not Null</label>
															<div class="col-sm-10">
																<input type="text" class="form-control" id="validation_dest_notnull_cols" placeholder="Enter Not Null Columns">
															</div>
														</div>
													</div>
												</div>

												<div class="col-sm-12">
													<div class="col-sm-2 pull pull-right">
														<a class="btn btn-success pull pull-right btn-ok" id="btn_save_rules">Submit Job</a>
													</div>
												</div>

											</div>
											<!-- <div class="col-md-12">
												<div class="modal fade" id="what4" role="dialog">
													123
												</div>
											</div>
											<div class="col-md-12">

												<img src="../dest/img/question.png" width="30px" height="30px" data-toggle="modal" data-target="#what4" />
											</div> -->

										</div>


							</div>
						</div>
					</div>
				</div>
				<!-- /.row -->
			</div>
			<!-- /#page-wrapper -->
			<footer>
				<p class="copyright">© Cygnet Infotech LLC, 2018</p>
			</footer>
		</div>
		<!-- /#wrapper -->
		
		<div class="ui-dialog" id="advancedRulesModal_noneed" style="z-index:9999;display: none;width: 50%;position: absolute;top: 5%;left: 20%;overflow-y: scroll;">
			<div class="modal-dialog" style="width: 800px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" id="advanced_noneed" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="myModalLabel">Advanced Rules Mapping</h4>
					</div>
					
					<div class="modal-body">
						<ul class="nav nav-tabs">
							<li class="active">
								<a data-toggle="tab" href="#column_map" aria-expanded="true">Column Map</a>
							</li>
							<!--<li>
								<a data-toggle="tab" href="#transmation" aria-expanded="false">Transformations</a>
							</li>-->
						</ul>
						
						<div class="tab-content" style="margin-top: 40px;">
							
							<div class="row tab-pane fade active in" id="column_map">
								<!--<img src="../dest/img/help.png" width="30px" height="30px" style="position: fixed;right: 20px;top: 75px" onclick="colMapHelp()" />-->
								<div class="accordion">
									<div class="panel-group" id="accordion">
										<div class="panel panel-default" style="margin-left: 30px;margin-right: 30px;border-radius: 0;margin-top:15px;">
											
											
											<div class="panel-heading" data-toggle="collapse" data-parent="#accordion"data-target="#collapseThree">
												<h3 class="panel-title accordion-toggle">Data Filter</h3>	
											</div>
											
											<div id="collapseThree" class="panel-collapse collapse">
												<div class="panel-body">
													<div class="col-md-12" style="margin-bottom: 25px;">
														<div class="form-group">
															<label class="col-sm-4">Compare only a sample records</label>
															<div class="col-sm-8">
																<input type="number" placeholder="Insert number of keys to comapre between 1 to 100,000" class="form-control" id="rule_randomsample" min="0">
															</div>
														</div>
													</div>
													<div class="col-md-12">
														<div class="form-group">
															<label class="col-sm-4">Source Filter Sql</label>
															<div class="col-sm-8">
																<input type="text" placeholder="Insert sql here to filter Source Dataset..." class="form-control" id="src_filter_sql">
															</div>
															<br><br>
														</div>
													</div>
													<div class="col-md-12">
														<div class="form-group">
															<label class="col-sm-4">Destination Filter Sql</label>
															<div class="col-sm-8">
																<input type="text" placeholder="Insert sql here to filter Destination Dataset..." class="form-control" id="dest_filter_sql">
															</div>
															<br><br>
														</div>
													</div>
													<div class="col-md-12">
														<div class="modal fade" id="what1" role="dialog">
															<div class="modal-dialog">
																<div class="modal-content">
																	<div class="modal-header">
																		<button type="button" class="close" data-dismiss-modal="modal2" aria-hidden="true">&times;</button>
																	</div>
																	<div class="modal-body">
																		<p><b>Run on sample of:</b>To run the data comparision on a sample(random) of records instead of the whole data. Accepts a number between 1 to 100,000.</p>
																		
																		<p>Note : The actual output may have less number of keys count. (As there could be multiple records for a key)</p>
																		<p><b>Src Filter Sql/dest Filter Sql :</b> To filter the dataset instead of comparing the whole data provide a SQL statement.</p>
																		
																		<p>Note :  You can refer to the dataset as my_data.</p>
																		
																		<p>Ex : select * from my_data where age > 30</p>
																	</div>
																</div>
															</div>
														</div>
													</div>
													
													
													<div class="col-md-12">
														<!--<button class="btn btn-danger" data-toggle="modal" data-target="#what" id="btn_delete">What is this</button>-->
														<img src="../dest/img/question.png" width="30px" height="30px" data-toggle="modal" data-target="#what1" />
													</div>
												</div>
											</div>
										</div>
										
										<div class="panel panel-default" style="margin-left: 30px;margin-right: 30px;border-radius: 0;margin-top:15px;">
											
											<div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseFour">
												<h3 class="panel-title accordion-toggle">Dataset Comparision Options</h3>	
											</div>
											<div id="collapseFour" class="panel-collapse collapse">
												<div class="panel-body">
													<div class="col-md-12">
														<div class="modal fade" id="what" role="dialog">
															<div class="modal-dialog">
																<div class="modal-content">
																	<div class="modal-header">
																		<button type="button" class="close" data-dismiss-modal="modal2" aria-hidden="true">&times;</button>
																	</div>
																	<div class="modal-body">
																		<p><b>Compare two way : </b>When the checkbox is selected compares both source and destination datasets with each other. When destination dataset is subset of source dataset unselect the check box.</p>	
																	</div>
																	
																</div>
															</div>
														</div>
													</div>
													<div class="col-md-12">
														<div class="checkbox" style="margin-bottom: 30px;display: inline-block;margin-left: 30px;">
															<label style="margin-right: 10px"><!--<input type="checkbox" id="rule_matchboth" checked> --><input type="checkbox" name="checkbox" value="" id="rule_matchboth" checked>Compare two way</label>
														</div>
													</div>
													<div class="col-md-12">
														
														<img src="../dest/img/question.png" width="30px" height="30px" data-toggle="modal" data-target="#what" />
													</div>
												</div>
											</div>
										</div>
										<div class="panel panel-default" style="margin-left: 30px;margin-right: 30px;border-radius: 0;margin-top:15px;">
											
											<div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseFive">
												<h3 class="panel-title accordion-toggle">Data Transformations</h3>	
											</div>
											
											<div id="collapseFive" class="panel-collapse collapse">
												<div class="panel-body">
													
													<div class="col-md-12">
														<div class="col-md-6">
															<label>Source Dataset</label>
															<div class="form-group row" style="margin-top: 15px;">
																<!--<label class="col-sm-3">Column</label>-->
																<div class="col-sm-9 src_dataset">
																	<div class="src_trans_column">
																		<input type="text" class="form-control ">
																	</div>
																</div>
																<label class="col-sm-3">SQL</label>
																<div class="col-sm-9">
																	<input type="text" placeholder="Enter transformation SQL" class="form-control src_trans_rule">
																</div>
															</div>
															<!--<div class="form-group row" id="src_trans_next">
																<button class="btn btn-default btn-sm col-sm-offset-4 col-sm-1" id="src_trans_plus">
																	<span class="glyphicon glyphicon-plus"></span>
																</button>
																<button class="btn btn-default btn-sm col-sm-offset-2 col-sm-1" id="src_trans_minus">
																	<span class="glyphicon glyphicon-minus"></span>
																</button>
															</div>-->
															
														</div>
														
														<div class="col-md-6">
															<label>Destination Dataset</label>
															<div class="form-group row" style="margin-top: 15px;" id="dest_trans_first">
																<!--<label class="col-sm-3">Column</label>-->
																<div class="col-sm-9 desti_dataset">
																	<div class="dest_trans_column">
																		<input type="text" class="form-control" value="">
																	</div>
																</div>
																<label class="col-sm-3">SQL</label>
																<div class="col-sm-9">
																	<input type="text" placeholder="Enter transformation SQL" class="form-control dest_trans_rule">
																</div>
															</div>
															<!--<div class="form-group row" id="dest_trans_next">
																<button class="btn btn-default btn-sm col-sm-offset-4 col-sm-1" id="dest_trans_plus">
																	<span class="glyphicon glyphicon-plus"></span>
																</button>
																<button class="btn btn-default btn-sm col-sm-offset-2 col-sm-1" id="dest_trans_minus">
																	<span class="glyphicon glyphicon-minus"></span>
																</button>
															</div>-->
														</div>
													</div>
													<div class="col-md-12">
														<div class="modal fade" id="what2" role="dialog">
															<div class="modal-dialog">
																<div class="modal-content">
																	<div class="modal-header">
																		<button type="button" class="close" data-dismiss-modal="modal2" aria-hidden="true">&times;</button>
																	</div>
																	<div class="modal-body">
																		<p>	<b>Transformations</b> : DiffTool provides ability to transform the columns before comparing. Transformation rule can be applied to one or more columns. The transformations can be applied using SQL functions.</p>
																		
																		<table class="table2" style="width:100%">
																			<th>Example scenario</th>
																			<th>Rule</th>
																			<tr>
																				<td>Convert column “first_name” to lower case</td>
																				<td>
																					LOWER(first_name) as first_name
																				</td>
																			</tr>
																			<tr>
																				<td>Convert column “first_name” to lower case , increase column “age” by 1</td>
																				<td>
																					LOWER(first_name) as first_name, (age+1) as age
																				</td>
																			</tr>
																			<tr>
																				<td>Trim a string and upper case for column “organization”</td>
																				<td>
																					trim(upper(organization)) as organization
																				</td>
																			</tr>
																			<tr>
																				<td>Make a substring of at most 10 charecters for column “organization”</td>
																				<td>
																					substring(organization,0,10)  as organization
																				</td>
																			</tr>
																			<tr>
																				<td>Join columns “first_name” and “last_name” and populate column “name” Note : column “name” should already exist and be marked for comparision.</td>
																				<td>
																					concat(first_name | last_name) as name
																				</td>
																			</tr>
																		</table>
																		
																		<style>
																			table.table2 tr {
																			text-transform: none;
																			}
																			table.table2 th{border: 1px solid black;
																			border-collapse: collapse;padding: 6px;}
																			
																			table.table2 td{border: 1px solid black;
																			border-collapse: collapse;padding: 6px;}
																		</style>
																	</div>
																</div>
															</div>
														</div>
													</div>
													<div class="col-md-12">
														<img src="../dest/img/question.png" width="30px" height="30px" data-toggle="modal" data-target="#what2" />
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!--changes-->
								<!-- <div id="cluster_resources" class="panel panel-default" style="margin-left: 30px;margin-right: 30px;border-radius: 0;margin-top:15px;">
								<div class="panel-heading" data-toggle="collapse" data-parent="#accordion"data-target="#cluster">
										<h3 class="panel-title accordion-toggle">Cluster Resources</h3>
									</div>
									<div id="cluster" class="panel-collapse collapse">
										<div class="panel-body">
									
									 <div class="col-md-12" style="margin-bottom: 25px;">
												<div class="form-group">
													<label class="col-sm-4">Number of Executors</label>
													<div class="col-sm-8">
														<input type="number" class="form-control" id="numExecutors" min="0">
													</div>
												</div>
											</div><br><br>
											
											<div class="col-md-12">
												<div class="form-group">
													<label class="col-sm-4">Executor Memory</label>
													<div class="col-sm-8">
														<input type="text" class="form-control" id="executorMemory">
													</div>
													<br><br>
												</div>
											</div>
											
											<div class="col-md-12" style="margin-bottom: 25px;">
												<div class="form-group">
													<label class="col-sm-4">Number of cores per executor</label>
													<div class="col-sm-8">
														<input type="number" class="form-control" id="executorCores" min="0">
													</div>
												</div>
											</div>
									
									
										</div>
									
									</div>
								</div> -->
								
									
											
								
								<!--end changes-->
								<div class="panel-body">
									<div class="col-md-12">
										<div class="modal fade" id="what3" role="dialog">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<button type="button" class="close" data-dismiss-modal="modal2" aria-hidden="true">&times;</button>
													</div>
													<div class="modal-body">
														
														
														<p><b>Source Dataset Columns</b> : Atleast one column needs to be a compare key column to compare datasets. Compare key columns are used to join the datasets in order to compare record by record. Select the check box next to column name to define a column/s as key column/s.  Drag the columns to map them to the corresponding column in the destination dataset.</p>
														
														<p><b>Destination Dataset Columns</b> :  Column names from the destination dataset. Drag the columns to map them to the corresponding source dataset column.</p>
														
														<p><b>Exclude Columns</b> : Only columns which have green icon next to them are compared. Click on the green icon( changes to red cross) to exclude the column from comparision.</p>
														
													</div>
													
													
												</div>
											</div>
										</div>
									</div>
									
									<div class="col-md-12">
										
										<img src="../dest/img/question.png" width="30px" height="30px" style="float: right" data-toggle="modal" data-target="#what3" />
									</div>
								</div>
								
								
								<div>
									<div class="col-md-12">
										<h3 class="data-filter-header">Columns Mapping</h3>
									</div>
									
									<div class="col-md-12">
										<!--<div class="checkbox" style="margin-left:30px;margin-bottom: 30px;display: inline-block">-->
										<!--<label style="margin-right: 10px"><input type="checkbox" value="" id="auto_mapping">Auto Column Mapping</label>-->
										<!--</div>-->
										
									</div>
									<div class="col-md-5">
									<ul style="padding-left: 0px;margin-left: 30px;">
											<label style="width: 100%;font-weight: bold;
											color: #000000;">Source Columns <span style="float:right">Compare Key<span style="color: red;"> *</span></span></label>
									</ul>
										<ul class="list-group connectedSortable1" style="padding-left: 0px;margin-left: 30px" id="src_column">	
										</ul>
									</div>

									<label style="position: relative; right: 325px; top: 84px; hfont-weight: bold;color: #000000;margin-left:-17%">Columns Included</label>

									<div class="col-md-2" style="margin-top: 35px;text-align: center;" id="mapper">
									</div>
									
									<div class="col-md-5">
										<ul style="padding-right: 0px;margin-right: 30px;">
											<label style="font-weight: bold;color: #000000;margin-left:-17%">Destination Columns</label>
										</ul>
										<ul class="list-group connectedSortable2" style="padding-right: 0px;margin-right: 30px;" id="dest_column">
											
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-default" id="btn_cancel_rules">Cancel</button>
						
					</div>
				</div>
			</div>
		</div>
		<!-- Advanced Rule Modal -->
		
		<div class="ui-dialog" id="advancedRulesModal" style="z-index:9999;display: none;width: 50%;position: absolute;top: 5%;left: 20%;">
			<div class="modal-dialog" style="width: 800px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" id="advanced" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="myModalLabel">Sample Data</h4>
					</div>
					
					<div class="modal-body">
						<ul class="nav nav-tabs">
							<!-- <li class="active">
								<a data-toggle="tab" href="#column_map" aria-expanded="true">Column Map</a>
							</li> -->
						</ul>
						<div class="tab-content" style="margin-top: 40px;">
							
							<div class="row tab-pane fade active in" id="column_map">
								<!--<img src="../dest/img/help.png" width="30px" height="30px" style="position: fixed;right: 20px;top: 75px" onclick="colMapHelp()" />-->
								<div class="accordion">
									<div class="panel-group" id="accordion">
										<div class="panel-body sample_data_div sample_data_table_unique">
											<h3>Unique Sample Data</h3>
											<table id="sample_data_table_unique" class="table table-hover"
												data-height="100%"
												data-search="true"
												data-show-export="true"
												data-show-columns="true"
												data-pagination="true" >
											</table>
										</div>

										<div class="panel-body sample_data_div sample_data_table_column">
											<h3>Column Sample Data</h3>
											<table id="sample_data_table_column" class="table table-hover"
												data-height="100%"
												data-search="true"
												data-show-export="true"
												data-show-columns="true"
												data-pagination="true" >
											</table>
										</div>

										<div class="panel-body sample_data_div sample_data_table_notnull">
											<h3>Not Null Sample Data</h3>
											<table id="sample_data_table_notnull" class="table table-hover"
												data-height="100%"
												data-search="true"
												data-show-export="true"
												data-show-columns="true"
												data-pagination="true" >
											</table>
										</div>

										<div class="panel-body sample_data_div sample_data_table_notempty">
											<h3>Not Empty Sample Data</h3>
											<table id="sample_data_table_notempty" class="table table-hover"
												data-height="100%"
												data-search="true"
												data-show-export="true"
												data-show-columns="true"
												data-pagination="true" >
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="modal-footer">
						<a class="btn btn-success btn-ok" id="btn_close">Close</a>
					</div>
				</div>
			</div>
		</div>

		<div class="ui-dialog" id="more" style="z-index:9999;display: none;width: 50%;position: absolute;top: 50%;left: 25%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" id="close1" aria-hidden="true">&times;</button>
				</div>
				<div class="modal-body">
					<table class="table table-striped" id="tblGrid">
						<thead id="tblHead">
						<tr>
							<th>Column Name</th>
							<th>Mismatch count</th>
						</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
		<div class="ui-dialog" id="more2" style="z-index:9999;display: none;width: 50%;position: absolute;top: 50%;left: 25%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" aria-hidden="true" id="close2">&times;</button>
				</div>
				<div class="modal-body">
					<table class="table table-striped" id="tblGrid2">
						<thead>
						<tr>
							<th>Mismatch Columns</th>
							<th>Mismatch count</th>
						</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</body>
	
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-93298501-2', 'auto');
		ga('send', 'pageview');
		
		$(function() {
			$('.panel-heading').click(function() {
				if ($(this).hasClass('accordion-opened')) {
					$(this).removeClass('accordion-opened');
					} else {
					$('.panel-heading').removeClass('accordion-opened');
					$(this).addClass('accordion-opened');
				}
			});
		});
		
		$(function() {
			$('.panel-heading.summary').click(function() {
				if ($(this).hasClass('accordion-closed')) {
					$(this).removeClass('accordion-closed');
					} else {
					$('.panel-heading').removeClass('accordion-opened');
					$('.panel-heading').removeClass('accordion-closed');
					$(this).addClass('accordion-closed');
				}
			});
			$('#btn_save_rules').on('click', function(e){
				submitJobJson();
			});
		});

		function submitJobJson() {

			var data = getInputData(srcRecordCnt != destRecordCnt, condition_sql, condition_column);
			
			if (data.compareKey.length <= 0) {
				//swal("Validation Error", "Atleast one column should be selectd as Compare Key.", "error");
				//return;
			}
			if (data.jobname == "") {
				swal("Validation Error", "Please enter a name for the job.", "error");
				return;
			}

			if (data.jobname == default_job_name){
				swal("Validation Error", "Please change a name of the job.", "error");
				return;
			}			

			var srcFile = data.srcFile;

			data.srcFile = inputData.srcFile;
			data.srcFile["validation_src_sql"] = srcFile["validation_src_sql"];
		    data.srcFile["validation_src_unique_cols"] = srcFile["validation_src_unique_cols"];
		    data.srcFile["validation_src_column_name"] = srcFile["validation_src_column_name"];
		    data.srcFile["validation_src_notnull_cols"] = srcFile["validation_src_notnull_cols"];
		    data.srcFile["validation_src_notempty_cols"] = srcFile["validation_src_notempty_cols"];

			data.destFile = inputData.destFile;
			
			//alert(data.sql);
			//console.log(data.destFile);
			
			var jsonStr = makeInputJson(data.jobname,data.compareCommonColumnsOnly,
            data.validateRowsCount,data.randomSample,data.matchBoth,true,
            data.columnMapping,data.srcFile,data.destFile,data.compareKey);
			
			//console.log(jsonStr);
			//alert(jsonStr);
			
			$.ajax({
				type: "POST",
				url: "/job",
				crossDomain: true,
				dataType: 'json',
				data: jsonStr,
				contentType: 'application/json',
				success: function (response) {
					//alert(response.jobname);
					jobId = response.jobIds[0];
					getJobResult(jobId);
					var url = window.location.href;
					url = url.substring(0, url.lastIndexOf('/'));
					window.location.href = url + '/home.html';
				},
				error: function (response) {
					//$('#advancedRulesModal').hide();
					$('#advancedRulesModal').hide();
				}
			});
		}

		function save_sql(type){

			var sql = $('#validation_src_sql').val();
			var min = $('#validation_src_sql_value_min').val();
			var max = $('#validation_src_sql_value_max').val();

			if (!sql){
				swal("Validation Error", "please input sql query.", "error");
				return;
			}

			if (!min && !max){
				swal("Validation Error", "please input min or max", "error");
				return;
			}

			var item = create_new_item(false, 'sql', sql, min, max);

			if (type == 'add'){
				condition_sql.push(item);

				condition_sql_current = -1;
				$('#save_btn_sql').addClass('disabled');

				$('#validation_src_sql').val('');
				$('#validation_src_sql_value_min').val('');
				$('#validation_src_sql_value_max').val('');

			}else if (type == 'save'){
				condition_sql[condition_sql_current] = item;
			}

			show_data_table(condition_sql, 'table_condition_sql');

			$('table tr').click(function(){
				edit_function(this);
			});

		}

		function save_column(type){

			var name = $('#validation_src_column_name').val();
			var min = $('#validation_src_column_min').val();
			var max = $('#validation_src_column_max').val();

			if (!name){
				swal("Validation Error", "please input field name.", "error");
				return;
			}

			if (!min && !max){
				swal("Validation Error", "please input min or max", "error");
				return;
			}

			var item = create_new_item(false, 'column', name, min, max);

			if (type == 'add'){
				condition_column.push(item);

				condition_column_current = -1;
				$('#save_btn_column').addClass('disabled');

				$('#validation_src_column_name').val('');
				$('#validation_src_column_min').val('');
				$('#validation_src_column_max').val('');

			}else if (type == 'save'){
				condition_column[condition_column_current] = item;
			}

			show_data_table(condition_column, 'table_condition_column');

			$('table tr').click(function(){
				edit_function(this);
			});

		}


		function edit_function(this_obj){
			var index = $(this_obj)[0].sectionRowIndex;
			var id = $(this_obj).parent().parent().prop('id');
			if (id == 'table_condition_sql'){

				$('#validation_src_sql').val(condition_sql[index][0].value);
				$('#validation_src_sql_value_min').val(condition_sql[index][1].value);
				$('#validation_src_sql_value_max').val(condition_sql[index][2].value);

				condition_sql_current = index;
				$('#save_btn_sql').removeClass('disabled');

			}else if (id == 'table_condition_column'){
				$('#validation_src_column_name').val(condition_column[index][0].value);
				$('#validation_src_column_min').val(condition_column[index][1].value);
				$('#validation_src_column_max').val(condition_column[index][2].value);

				condition_column_current = index;
				$('#save_btn_column').removeClass('disabled');
			}else if (id == 'table_condition_notnull'){
				condition_notnull_current = index;
			}else if (id == 'table_condition_notempty'){
				condition_notempty_current = index;
			}
		}
		
	</script>
	<style>
		
		#mapper div img {
		height: 82% !important;
		width: 52% !important;
		}
		.modal { overflow: auto !important; }
		
		.ui-state-highlight { background: #A9A9A9 !important; border-color: #A9A9A9 !important }
		td.intro {
		display:none !important;
		}
		th.intro {
		display:none !important;
		}
		.accordion-toggle:after {
		font-family: 'FontAwesome';
		content: "\f078";    
		float: right;
		}
		
		h3.panel-title.accordion-toggle.summary:after {
		font-family: 'FontAwesome';
		content: "\f077";    
		float: right;
		}
		
		.accordion-closed h3.panel-title.accordion-toggle.summary:after {    
		content: "\f078";    
		}
		.accordion-opened .accordion-toggle:after {    
		content: "\f077";    
		}
		.panel-heading {
		cursor: pointer;
		}
		
		.glyphicon.glyphicon-remove {
		color: red;
		}
		
		
		.col-sm-9.desti_dataset{
			display: none !important;
		}
		.col-sm-9.src_dataset{
			display: none !important;
		}
	</style>
	
</html>

